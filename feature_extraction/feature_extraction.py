# -*- coding: UTF-8 -*-.
import argparse
import os
from pe import PE
import csv

GOODWARE = 0
MALWARE = 1
CSV_FILE="softwares.csv"

def params():
    parser = argparse.ArgumentParser()
    parser.add_argument('goodwares_location', help='Goodwares files location')
    parser.add_argument('malwares_location', help='Goodwares files location')
    params = parser.parse_args()
    return params.goodwares_location, params.malwares_location

def feature_extraction(pe):
    return pe.fe_values()

def initilize_csv(location):
    c = csv.writer(open(CSV_FILE, "a"))
    for root, dirs, files in os.walk(location):
        for f in sorted(files):
            try:
                file_loc = os.path.join(root, f)
                pe = PE(file_loc,name=f,strings=True)
                header = pe.fe_methods()
                header.append("Label")
                c.writerow(header)
                return
            except:
                print "Invalid file."
                pass

def feature_extraction(location, label):
    c = csv.writer(open(CSV_FILE, "a"))
    for root, dirs, files in os.walk(location):
        for f in sorted(files):
            try:
                file_loc = os.path.join(root, f)
                pe = PE(file_loc,name=f,strings=True)
                features = pe.fe_values()
                features.append(label)
                c.writerow(features)
            except:
                print "Invalid file."
                pass

# get files location
goodwares_location, malwares_location = params()
# initize csv and write header
initilize_csv(goodwares_location)
# extract features from goodwares
feature_extraction(goodwares_location, GOODWARE)
# extract features from malwares
feature_extraction(malwares_location, MALWARE)
